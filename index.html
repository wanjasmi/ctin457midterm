
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kansas City Tourist Market — Results Tornado (Locked Scale)</title>
<style>
  :root { --accent:#c7ed2e; --ink:#111; --muted:#777; --bg:#fff; --card:#f7f7f7; }
  html, body { margin:0; padding:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink); background:var(--bg) }
  header { padding:18px 22px; border-bottom:1px solid #e9e9e9; display:flex; align-items:baseline; gap:12px }
  header h1 { font-size:20px; margin:0; font-weight:700 }
  header .subtitle { color:var(--muted); font-size:13px }
  main { padding:20px; display:grid; gap:18px; grid-template-columns:380px 1fr }
  .panel { background:var(--card); border-radius:12px; padding:14px; box-shadow:0 1px 0 rgba(0,0,0,.04) inset }
  .panel h2 { font-size:15px; margin:4px 0 10px 0 }
  .row { display:grid; grid-template-columns: 1fr 140px; align-items:center; gap:10px; margin:8px 0 }
  .row .label { font-size:13px; color:#333 }
  input[type='number'] { width:100%; padding:6px 8px; border:1px solid #ddd; border-radius:8px }
  .help { font-size:12px; color:var(--muted); margin-top:8px }
  .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:10px }
  .kpi { background:#fff; border-radius:10px; padding:12px; border:1px solid #eee }
  .kpi .k { font-size:12px; color:var(--muted) }
  .kpi .v { font-size:18px; font-weight:700 }
  canvas { width:100%; height:420px; border:1px solid #eee; border-radius:10px; background:#fff }
  .btns { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap }
  button { padding:8px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer }
  button.primary { background: var(--accent); border-color:#b1d629; font-weight: 600 }
  .note { font-size:12px; color:#444 }
  footer { padding:12px 20px; color:#666; font-size:12px }
  .fixed { color:#333; font-weight:600; font-size:13px }
  .controlline { display:flex; align-items:center; gap:10px; margin-top:8px; font-size:12px; color:#333 }
  .controlline input[type='checkbox'] { transform: scale(1.2); }
  .scaleinfo { font-size:12px; color:#555 }
</style>
</head>
<body>
<header>
  <h1>KC Tourist Market — Results Tornado</h1>
  <div class="subtitle">Bars use a <b>locked scale</b> by default so lengths only change when their own values change.</div>
</header>
<main>
  <!-- Inputs -->
  <section class="panel">
    <h2>Inputs</h2>
    <div class="row"><div class="label">Rooms (fixed)</div><div class="fixed">18,055</div></div>
    <div class="row"><div class="label">Avg Annual Occupancy Rate (0–1)</div><input id="occ" type="number" step="0.01" min="0" max="1" value="0.61" /></div>
    <div class="row"><div class="label">Avg Number of Persons per Room</div><input id="ppr" type="number" step="0.1" min="0.5" max="4" value="1.4" /></div>
    <div class="row"><div class="label">Avg Length of Stay (nights)</div><input id="alos" type="number" step="0.1" min="0.5" max="21" value="2.3" /></div>
    <div class="row"><div class="label">Est. % of Overnight Visitors Who Stay in Hotels</div><input id="hotelShare" type="number" step="0.01" min="0.01" max="0.99" value="0.55" /></div>
    <div class="row"><div class="label">Overnight Visitors as % of Total Visitors</div><input id="overnightShare" type="number" step="0.01" min="0.01" max="0.99" value="0.71" /></div>
    <div class="btns">
      <button class="primary" onclick="recalc()">Recalculate</button>
      <button onclick="resetInputs()">Reset to Baseline</button>
    </div>
    <div class="controlline">
      <label><input id="lockScale" type="checkbox" checked /> Lock bar scale to baseline</label>
      <button onclick="rebaseScale()">Rebase scale to current</button>
    </div>
    <div class="scaleinfo" id="scaleInfo">Scale max (baseline): —</div>
    <div class="help">With the scale locked, a bar's length only changes when that metric's value changes; other metrics won't affect its length.</div>
  </section>

  <!-- Right: Results bars + KPIs -->
  <section class="panel">
    <h2>Results Tornado (bar length ∝ current values; fixed scale)</h2>
    <canvas id="tornado" width="900" height="420"></canvas>
    <div class="help">Color: <b>#c7ed2e</b>. If a value exceeds the locked scale max, the bar caps and shows a “&gt;” overflow indicator.</div>
  </section>

  <section class="panel">
    <h2>Results</h2>
    <div class="grid">
      <div class="kpi"><div class="k">Number of Occupied Rooms (avg daily)</div><div id="occRooms" class="v">—</div></div>
      <div class="kpi"><div class="k">Annual Occupied Room‑Nights</div><div id="orn" class="v">—</div></div>
      <div class="kpi"><div class="k">Annual Person‑Nights</div><div id="pn" class="v">—</div></div>
      <div class="kpi"><div class="k">Annual Hotel Visitors (unique)</div><div id="hv" class="v">—</div></div>
      <div class="kpi"><div class="k">Annual Overnight Visitors (all accom)</div><div id="ov" class="v">—</div></div>
      <div class="kpi"><div class="k">Total Annual Visitors</div><div id="tv" class="v">—</div></div>
    </div>
    <div class="help note">Formulae: 
      <br>Occupied Rooms = Rooms × Occupancy
      <br>Occupied Room‑Nights = Occupied Rooms × 365
      <br>Person‑Nights = Room‑Nights × Persons/Room
      <br>Hotel Visitors = Person‑Nights ÷ Avg LOS
      <br>Overnight Visitors = Hotel Visitors ÷ Est. % staying in hotels
      <br>Total Visitors = Overnight Visitors ÷ Overnighters as % of Total
    </div>
  </section>
</main>
<footer>Built for offline use. All math runs in-browser.</footer>

<script>
const ROOMS = 18055;
const fmt = (n) => n.toLocaleString(undefined, {maximumFractionDigits:0});

let baselineInputs = { occ: 0.61, ppr: 1.4, alos: 2.3, hotelShare: 0.55, overnightShare: 0.71 };
let scaleMax = null;  // will be computed from baseline results

function readInputs() {
  return {
    occ: parseFloat(document.getElementById('occ').value || 0),
    ppr: parseFloat(document.getElementById('ppr').value || 0),
    alos: parseFloat(document.getElementById('alos').value || 1),
    hotelShare: parseFloat(document.getElementById('hotelShare').value || 0.5),
    overnightShare: parseFloat(document.getElementById('overnightShare').value || 0.7),
  };
}

function computeResults(inp) {
  const occupiedRooms = ROOMS * inp.occ;                    // avg daily
  const roomNights = occupiedRooms * 365;                   // annual
  const personNights = roomNights * inp.ppr;                // annual
  const hotelVisitors = personNights / inp.alos;            // annual
  const overnightVisitors = hotelVisitors / inp.hotelShare; // annual
  const totalVisitors = overnightVisitors / inp.overnightShare; // annual
  return { occupiedRooms, roomNights, personNights, hotelVisitors, overnightVisitors, totalVisitors };
}

function maxResultValue(r) {
  return Math.max(r.occupiedRooms, r.roomNights, r.personNights, r.hotelVisitors, r.overnightVisitors, r.totalVisitors);
}

function recalc() {
  const inp = readInputs();
  const r = computeResults(inp);

  // KPIs
  document.getElementById('occRooms').textContent = fmt(r.occupiedRooms);
  document.getElementById('orn').textContent      = fmt(r.roomNights);
  document.getElementById('pn').textContent       = fmt(r.personNights);
  document.getElementById('hv').textContent       = fmt(r.hotelVisitors);
  document.getElementById('ov').textContent       = fmt(r.overnightVisitors);
  document.getElementById('tv').textContent       = fmt(r.totalVisitors);

  drawResultsTornado(r);
}

function resetInputs() {
  document.getElementById('occ').value = baselineInputs.occ;
  document.getElementById('ppr').value = baselineInputs.ppr;
  document.getElementById('alos').value = baselineInputs.alos;
  document.getElementById('hotelShare').value = baselineInputs.hotelShare;
  document.getElementById('overnightShare').value = baselineInputs.overnightShare;
  recalc();
}

function rebaseScale() {
  // Set the locked scale max to the CURRENT max of results
  const r = computeResults(readInputs());
  scaleMax = maxResultValue(r);
  updateScaleInfo();
  drawResultsTornado(r);
}

function updateScaleInfo() {
  const info = document.getElementById('scaleInfo');
  const locked = document.getElementById('lockScale').checked;
  if (locked) {
    info.textContent = "Scale max (locked): " + fmt(scaleMax);
  } else {
    info.textContent = "Scale max (dynamic): current results' maximum";
  }
}

function drawResultsTornado(r) {
  const items = [
    {name:'Number of Occupied Rooms (avg daily)', value:r.occupiedRooms},
    {name:'Annual Occupied Room‑Nights', value:r.roomNights},
    {name:'Annual Person‑Nights', value:r.personNights},
    {name:'Annual Hotel Visitors (unique)', value:r.hotelVisitors},
    {name:'Annual Overnight Visitors', value:r.overnightVisitors},
    {name:'Total Annual Visitors', value:r.totalVisitors},
  ];

  const canvas = document.getElementById('tornado');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // layout
  const left = 230, right = W - 30, top = 30, bottom = H - 30;
  const barH = (bottom - top) / items.length - 10;

  // choose scale
  let maxVal;
  const locked = document.getElementById('lockScale').checked;
  if (locked && scaleMax != null) {
    maxVal = scaleMax;
  } else {
    maxVal = Math.max(...items.map(i => i.value)) || 1;
  }

  ctx.font = "12px system-ui, sans-serif";
  ctx.fillStyle = "#333";
  ctx.fillText("Results (bar length proportional to value; " + (locked ? "locked" : "dynamic") + " scale)", left, top - 10);

  items.forEach((it, i) => {
    const y = top + i * (barH + 10);
    // Label
    ctx.fillStyle = "#444";
    ctx.fillText(it.name, 20, y + barH * 0.7);
    // Bar
    let ratio = it.value / maxVal;
    let overflow = false;
    if (ratio > 1 && locked) { ratio = 1; overflow = true; }
    const w = ratio * (right - left);
    ctx.fillStyle = "#c7ed2e";
    ctx.fillRect(left, y, w, barH);
    // Value (+ overflow marker if any)
    ctx.fillStyle = "#222";
    const valText = (overflow ? "> " : "") + it.value.toLocaleString(undefined, {maximumFractionDigits:0});
    ctx.fillText(valText, left + w + 6, y + barH * 0.7);
  });
}

function autoBind() {
  ['occ','ppr','alos','hotelShare','overnightShare'].forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener('input', recalc);
    el.addEventListener('change', recalc);
  });
  document.getElementById('lockScale').addEventListener('change', () => {
    updateScaleInfo();
    recalc();
  });
}

window.addEventListener('load', () => {
  autoBind();
  // Compute baseline and set lock scale to baseline max
  const baselineResults = computeResults(baselineInputs);
  scaleMax = maxResultValue(baselineResults);
  updateScaleInfo();
  resetInputs();
});
</script>
</body>
</html>
